/*
* @name SPCalendarPro
* Version 2018.01
* No dependencies!
* @description An ultra lightweight JavaScript library to easily manage SharePoint calendar events.
* @category Plugins/SPCalendarPro
* @author Sam Perrow sam.perrow399@gmail.com
*
* Copyright 2018  Sam Perrow  (email : sam.perrow399@gmail.com)
* Licensed under the MIT license:
* http://www.opensource.org/licenses/mit-license.php
*/

!function(e,t){e.spcalpro=function(){function e(e,t,n){return e.userDateTimes={startDateTime:t,startDate:t.toDateString(),startTime:t.toTimeString(),endDateTime:n,endDate:n.toDateString(),endTime:n.toTimeString()},e}r.prototype.isSameDate=function(){var e=this.userDateTimes.startDate,t=this.userDateTimes.endDate;return this.events=this.events.filter(function(n){return new Date(n.EventDate).toDateString()===e&&new Date(n.EndDate).toDateString()===t}),this},r.prototype.matchDateTimes=function(){var e=this.userDateTimes.startDateTime,t=this.userDateTimes.endDateTime;return this.events=this.events.filter(function(n){return new Date(n.EventDate)<=e&&new Date(n.EndDate)>=t}),this},r.prototype.isTimeConflict=function(){var e=this.userDateTimes.startDateTime,t=this.userDateTimes.endDateTime;return this.events=this.events.filter(function(n){var r=new Date(n.EventDate),a=new Date(n.EndDate);return e<=r&&t>=a||r<e&&a>e||r<t&&a>t||e<r&&t>a}),this},r.prototype.where=function(e){var t=e.split(" ")[0],n=e.split(" ")[1],r=e.split(" ")[2],a={"=":function(e,t){return e==t},">":function(e,t){return e>new Number(t)},"<":function(e,t){return e<new Number(t)},">=":function(e,t){return e>=new Number(t)},"<=":function(e,t){return e<=new Number(t)},"!=":function(e,t){return e!=t}};return this.events=this.events.filter(function(e){return a[n](e[t],r)}),this},r.prototype.getDateTimesFromForm=function(t=0,r=1){var a=n(t,r);return e(this,a.userBeginDT,a.userEndDT)},r.prototype.provideDateTimes=function(t,n){return e(this,t,n)};var t=function(e,t=!0,n){var r,a,s,i=[];a="<DateRangesOverlap><FieldRef Name='EventDate'/><FieldRef Name='EndDate'/><FieldRef Name='RecurrenceID'/><Value Type='DateTime'><Year/></Value></DateRangesOverlap>",s="</Where><OrderBy><FieldRef Name='EventDate'/></OrderBy></Query></query><queryOptions><QueryOptions><RecurrencePatternXMLVersion>v3</RecurrencePatternXMLVersion><ExpandRecurrence>TRUE</ExpandRecurrence><RecurrenceOrderBy>TRUE</RecurrenceOrderBy><ViewAttributes Scope='RecursiveAll'/></QueryOptions></queryOptions></GetListItems>",r="single"===n?"<query><Query><Where><Eq><FieldRef Name='fRecurrence'/><Value Type='Number'>0</Value></Eq></Where></Query></query></GetListItems>":"recurring"===n?"<query><Query><Where><And>"+a+"<Eq><FieldRef Name='fRecurrence'/><Value Type='Number'>1</Value></Eq></And>"+s:"<query><Query><Where>"+a+s,function(e,n){var r=new XMLHttpRequest;return r.open("POST",e,t),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Content-Type",'text/xml;charset="utf-8"'),r.send(n),!0===t?r.onreadystatechange=a():a();function a(){if(4==r.readyState&&200==r.status)return i=function(e){for(var t=[],n=0;n<e.length;n++){var r={},a=e[n].attributes;if("z:row"===e[n].nodeName){for(var s=0;s<a.length;s++){var i=a[s].name,u=i.split("ows_")[1];r[u]=a[s].value}t.push(r)}}return t}(r.responseXML.querySelectorAll("*"))}}(document.location.origin+_spPageContextInfo.webServerRelativeUrl+"/_vti_bin/Lists.asmx","<soap:Envelope xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xmlns:xsd='http://www.w3.org/2001/XMLSchema' xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'><soap:Body><GetListItems xmlns='http://schemas.microsoft.com/sharepoint/soap/'><listName>"+e+"</listName>"+r+"</soap:Body></soap:Envelope>");return i},n=function(e=0,t=1){var n,r,a=document.querySelectorAll('input[id$="DateTimeField_DateTimeFieldDate"]')[e].parentNode.parentNode,s=document.querySelectorAll('input[id$="DateTimeField_DateTimeFieldDate"]')[t].parentNode.parentNode,i=a.getElementsByTagName("td")[0].getElementsByTagName("input")[0],u=a.getElementsByClassName("ms-dttimeinput")[0].getElementsByTagName("select")[0],o=a.getElementsByClassName("ms-dttimeinput")[0].getElementsByTagName("select")[1],m=s.getElementsByTagName("td")[0].getElementsByTagName("input")[0],l=s.getElementsByClassName("ms-dttimeinput")[0].getElementsByTagName("select")[0],p=s.getElementsByClassName("ms-dttimeinput")[0].getElementsByTagName("select")[1];String.prototype.formatInputToHours=function(){var e=this.split(" "),t=Number(e[0]);return"PM"===e[1]&&t<12?t+=12:t};var c,D;c=u.value.formatInputToHours()+":"+o.value,D=l.value.formatInputToHours()+":"+p.value,n=new Date(i.value+" "+c),r=new Date(m.value+" "+D);return{userBeginDT:n,userEndDT:r}};function r(e,n,r){return this.listName=e,this.events=t(this.listName,n,r),this.userDateTimes={},this}return{getEvents:function(e,t,n){return new r(e,t,n)}}}()}(this);